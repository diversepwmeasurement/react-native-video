jobs:
  build:
    defaults:
      run:
        working-directory: examples/basic/ios
    name: Build iOS Example App
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      uses: actions/checkout@v4
    - continue-on-error: true
      name: Install node_modules
      uses: ./.github/actions/setup-node
      with:
        working-directory: examples/basic
    - continue-on-error: true
      name: Restore buildcache
      uses: mikehardy/buildcache-action@v2
    - continue-on-error: true
      name: Setup Ruby (bundle)
      uses: ruby/setup-ruby@v1
      with:
        bundler-cache: true
        ruby-version: 2.6.10
    - continue-on-error: true
      name: Restore Pods cache
      uses: actions/cache@v3
      with:
        key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
        path: 'examples/basic/ios/Pods

          ~/Library/Caches/CocoaPods

          ~/.cocoapods

          '
        restore-keys: '${{ runner.os }}-pods-

          '
    - continue-on-error: true
      name: Install Pods
      run: pod install
    - continue-on-error: true
      name: Install xcpretty
      run: gem install xcpretty
    - continue-on-error: true
      name: Build App
      run: set -o pipefail && xcodebuild -derivedDataPath build -UseModernBuildSystem=YES
        -workspace videoplayer.xcworkspace -scheme videoplayer -sdk iphonesimulator
        -configuration Debug -destination 'platform=iOS Simulator,name=iPhone 14'
        build CODE_SIGNING_ALLOWED=NO | xcpretty
  build-with-ads:
    defaults:
      run:
        working-directory: examples/basic/ios
    name: Build iOS Example App With Ads
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      uses: actions/checkout@v4
    - continue-on-error: true
      name: Install node_modules
      uses: ./.github/actions/setup-node
      with:
        working-directory: examples/basic
    - continue-on-error: true
      name: Restore buildcache
      uses: mikehardy/buildcache-action@v2
    - continue-on-error: true
      name: Setup Ruby (bundle)
      uses: ruby/setup-ruby@v1
      with:
        bundler-cache: true
        ruby-version: 2.6.10
    - continue-on-error: true
      name: Restore Pods cache
      uses: actions/cache@v3
      with:
        key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
        path: 'examples/basic/ios/Pods

          ~/Library/Caches/CocoaPods

          ~/.cocoapods

          '
        restore-keys: '${{ runner.os }}-pods-

          '
    - continue-on-error: true
      name: Install Pods
      run: export RNV_SAMPLE_ENABLE_ADS=true && pod install
    - continue-on-error: true
      name: Install xcpretty
      run: gem install xcpretty
    - continue-on-error: true
      name: Build App
      run: set -o pipefail && export RNV_SAMPLE_ENABLE_ADS=true && xcodebuild -derivedDataPath
        build -UseModernBuildSystem=YES -workspace videoplayer.xcworkspace -scheme
        videoplayer -sdk iphonesimulator -configuration Debug -destination 'platform=iOS
        Simulator,name=iPhone 14' build CODE_SIGNING_ALLOWED=NO | xcpretty
  build-with-caching:
    defaults:
      run:
        working-directory: examples/basic/ios
    name: Build iOS Example App With Caching
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      uses: actions/checkout@v4
    - continue-on-error: true
      name: Install node_modules
      uses: ./.github/actions/setup-node
      with:
        working-directory: examples/basic
    - continue-on-error: true
      name: Restore buildcache
      uses: mikehardy/buildcache-action@v2
    - continue-on-error: true
      name: Setup Ruby (bundle)
      uses: ruby/setup-ruby@v1
      with:
        bundler-cache: true
        ruby-version: 2.6.10
    - continue-on-error: true
      name: Restore Pods cache
      uses: actions/cache@v3
      with:
        key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
        path: 'examples/basic/ios/Pods

          ~/Library/Caches/CocoaPods

          ~/.cocoapods

          '
        restore-keys: '${{ runner.os }}-pods-

          '
    - continue-on-error: true
      name: Install Pods
      run: export RNV_SAMPLE_VIDEO_CACHING=true && pod install
    - continue-on-error: true
      name: Install xcpretty
      run: gem install xcpretty
    - continue-on-error: true
      name: Build App
      run: set -o pipefail && export RNV_SAMPLE_VIDEO_CACHING=true && xcodebuild -derivedDataPath
        build -UseModernBuildSystem=YES -workspace videoplayer.xcworkspace -scheme
        videoplayer -sdk iphonesimulator -configuration Debug -destination 'platform=iOS
        Simulator,name=iPhone 14' build CODE_SIGNING_ALLOWED=NO | xcpretty
name: Build iOS
on:
  repository_dispatch:
    types: trigger-ga___build-ios.yml
